# 004: Wrapper script, test script, and README

## Context

Steps 001–003 produced the COBOL source code for the MCP server. But a COBOL source file alone isn't usable — someone needs to know how to compile it, how to point an MCP client at it, and what it does. This step creates the surrounding infrastructure that turns a `.cob` file into a project:

- A wrapper script that compiles and runs the server (the entry point MCP clients invoke)
- A protocol conformance test script that validates the server's behavior end-to-end (for anyone who has GnuCOBOL installed)
- A README that explains the project, documents the tools, and provides MCP client configuration examples

These are the files that make the difference between "a COBOL file in a repo" and "a project someone could actually clone and use (or at least laugh at)."

## Related Code

- `src/mcp-server.cob` — The COBOL source file created in steps 001–003. The wrapper script needs to know its path to compile it. The test script needs to understand the server's expected JSON-RPC behavior to validate it.
- `tasks/0001-cobol-mcp-server/testing.md` — The testing plan describes the exact protocol conformance tests the test script should implement.
- `tasks/0001-cobol-mcp-server/requirements.md` — The requirements list all success criteria the README should address.
- `tasks/0001-cobol-mcp-server/architecture.md` — The architecture describes the tools, lifecycle flow, and failure modes that the README should document.

## Reuse Opportunities

None — these are all new files. The test script's test cases are derived from the testing plan spec.

## Deliverables

### Wrapper script: `run.sh`

A shell script (bash) that serves as the entry point for MCP clients. It must:

- Check whether the `cobc` (GnuCOBOL compiler) command is available on the system
- If `cobc` is not found, print a clear, helpful error message to stderr explaining that GnuCOBOL is required and suggesting how to install it (e.g., package manager commands for common OSes like apt, brew, dnf)
- If `cobc` is found, compile the COBOL source file into an executable (in a temporary or build directory to keep the project clean)
- Run the compiled executable, passing through stdin and stdout so the MCP client can communicate with it over stdio transport
- Exit with the same exit code as the COBOL server process
- Must be marked executable (chmod +x)
- Should use a shebang line for bash

### Protocol conformance test script: `test/test-mcp-server.sh`

A shell script that exercises the compiled MCP server by piping JSON-RPC messages to its stdin and validating the responses on stdout. This script is a deliverable for users who have GnuCOBOL installed — it will not run in CI since there's no COBOL compiler in the build environment. It must:

- Check for GnuCOBOL availability and skip gracefully if not installed
- Compile the COBOL source (or use the wrapper script to do so)
- Run a series of test cases, each sending a specific JSON-RPC message and checking the response

**Test cases to include (derived from testing.md):**

Lifecycle tests:
- Send an `initialize` request and verify the response contains `protocolVersion`, `serverInfo`, and `capabilities` with `tools`
- Send a `notifications/initialized` notification and verify no output is produced
- Send a `ping` request and verify the response has an empty result and the correct `id`

Tool listing tests:
- Send a `tools/list` request and verify the response contains three tools with the names `add`, `format_currency`, and `validate_date`

Tool execution tests:
- Call `add` with two integers and verify the response contains the correct sum
- Call `add` with decimal values and verify the sum is correct
- Call `add` with non-numeric input and verify the response has `isError` true
- Call `format_currency` with a number and verify the response contains a dollar-formatted string
- Call `format_currency` with zero and verify it returns a sensible result
- Call `format_currency` with a large number and verify comma separators appear
- Call `validate_date` with a valid date and verify it reports valid
- Call `validate_date` with an invalid month and verify it reports invalid
- Call `validate_date` with an impossible day and verify it reports invalid
- Call `validate_date` with Feb 29 on a leap year and verify it reports valid
- Call `validate_date` with Feb 29 on a non-leap year and verify it reports invalid

Error handling tests:
- Send a request with an unknown method and verify a -32601 error response
- Call `tools/call` with an unknown tool name and verify `isError` true in the result
- Verify all responses include `jsonrpc` version 2.0
- Verify response `id` values match the request `id` values

The test script should report a summary of passed/failed tests and exit with a non-zero code if any tests fail. Must be marked executable.

### README: `README.md`

The project README. This is a joke project so the tone should be fun, but the content should be genuinely informative. It must include:

**Project title and description:**
- A clear, attention-grabbing title
- A brief explanation of what this is (an MCP server written in COBOL) and why it exists (because someone had to)

**What is MCP:**
- A one-paragraph explanation of the Model Context Protocol for readers who don't know what it is, with a link to the official site

**Tools documentation:**
- A section listing all three tools with their names, descriptions, what arguments they take, and what they return
- Should highlight the COBOL PICTURE clause angle for currency formatting

**Prerequisites:**
- GnuCOBOL must be installed
- How to install it on common platforms (apt, brew, etc.)

**How to run:**
- Instructions for running the server directly via the wrapper script
- Mention that it communicates over stdio

**MCP client configuration:**
- How to add this server to Claude Desktop (the `claude_desktop_config.json` entry pointing to the wrapper script)
- How to add it to other MCP clients that support stdio servers (generic pattern)

**How to test:**
- How to run the protocol conformance test script

**License / contributing / etc.:**
- At the implementer's discretion — keep it brief

## Acceptance Criteria

- [x] `run.sh` exists at the project root and is executable
- [x] `run.sh` checks for `cobc` availability and prints a helpful error if not found
- [x] `run.sh` compiles the COBOL source file using `cobc` and runs the resulting binary
- [x] `run.sh` passes stdin/stdout through to the compiled server for stdio transport
- [x] `test/test-mcp-server.sh` exists and is executable
- [x] The test script checks for GnuCOBOL and skips gracefully if not installed
- [x] The test script includes test cases for initialize, ping, tools/list, tools/call for all three tools, and error handling
- [x] The test script reports pass/fail results for each test case
- [x] The test script exits with non-zero status if any test fails
- [x] `README.md` exists and is non-empty
- [x] The README explains what the project is and why it exists
- [x] The README documents all three tools by name with their arguments
- [x] The README includes GnuCOBOL installation instructions
- [x] The README includes Claude Desktop configuration (mentions `claude_desktop_config.json` or equivalent)
- [x] The README includes instructions for running the server and the test script
